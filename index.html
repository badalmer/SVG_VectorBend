<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background-color: black;
      color: white;
    }

    #fileInput {
      background-color: #0088FF;
      color: white;
      padding: 10px;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }

    #output {
      padding-top: 10px;
      text-align: left;
      font-size: 16px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .result {
      margin-top: 20px;
      text-align: left;
    }

    .download-link {
      margin-top: 10px;
      font-size: 14px;
      color: #00CC55;
      cursor: pointer;
      text-decoration: underline;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>

<body>
  <h1>SVG Modifier</h1>
  <p>Upload an SVG file to start the modification process.</p>
  <input type="file" id="fileInput" accept=".svg" onchange="handleFile(this.files)">
  <div id="output"></div>

  <script>
    let svgText;
    let newData;
    let numCopy = 2;
    let corLevel = 66;
    let fileInput;

    function setup() {
      // Your setup function remains the same
    }

    function draw() {
      // Your draw function remains the same
    }

    function recolor(oldData) {
      let c = oldData.match(/fill:(.*?);}/);
      if (c != null) {
        newData = oldData.replace(c[0], RandPick());
      } else {
        newData = oldData;
      }
    }

    function handleFile(files) {
      if (files.length > 0) {
        let myFile = files[0];
        let reader = new FileReader();
        reader.onload = function (event) {
          svgText = event.target.result.split('\n');
          processSVG();
        };
        reader.readAsText(myFile);
      } 
    }

    function processSVG() {
      let outputDiv = document.getElementById("output");
      outputDiv.innerHTML = ""; // Clear previous results

      for (let i = 0; i < numCopy; i++) {
        let resultDiv = document.createElement("div");
        resultDiv.classList.add("result");

        let previewIframe = document.createElement("iframe");
        previewIframe.style.width = "100%";
        previewIframe.style.height = "250px"; // Set the desired height
        previewIframe.srcdoc = svgText.join('\n');

        resultDiv.appendChild(previewIframe);

        for (let j = 0; j < svgText.length; j++) {
          if (j > 30) {
            for (let c = 0; c < corLevel; c++) {
              recolor(svgText[j]);
            }
          } else {
            recolor(svgText[j]);
          }
          resultDiv.innerHTML += newData + "<br>";
        }

        outputDiv.appendChild(resultDiv);
        createDownloadLink(newData, i);
        corLevel += 500;
      }
      noLoop();
    }

    function createDownloadLink(data, index) {
      let downloadLink = document.createElement("a");
      downloadLink.classList.add("download-link");
      downloadLink.innerHTML = "Download Result " + (index + 1);
      downloadLink.href = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(data);
      downloadLink.download = "result_" + (index + 1) + ".svg";

      let outputDiv = document.getElementById("output");
      outputDiv.appendChild(downloadLink);
    }

    function RandPick() {
      let randomColor = "#" + ("00000" + ((Math.random() * 16777215 + 0.5) | 0).toString(16)).slice(-6);
      console.log("Generated Color: " + randomColor);
      return "fill:" + randomColor + ";}";
    }
  </script>
</body>
</html>
